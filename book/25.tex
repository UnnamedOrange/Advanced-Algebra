% Licensed under the Creative Commons Attribution Share Alike 4.0 International.
% See the LICENCE file in the repository root for full licence text.

\chapter{二次型与矩阵的合同}

\section{二次型标准形与合同}

\subsection{二重线性函数}

\begin{definition}{多重线性函数}
	若有 $f: \underset{\text{$m$ 个}}{\underbrace{\mathbb K^n \times \mathbb K^n \times \cdots \times \mathbb K^n}} \to \mathbb K$，且 $\forall i = 1, \ldots, m$，都满足：
	$$
	\begin{aligned}&
		f(\vec \alpha_1, \ldots, a_i \vec \alpha_i + a'_i \vec \alpha'_i, \ldots, \vec \alpha_s)
		\\=~&
		a_i f(\vec \alpha_1, \ldots, \vec \alpha_i, \ldots, \vec \alpha_s) + a'_i f(\vec \alpha_1, \ldots, \vec \alpha'_i, \ldots, \vec \alpha_s)
	\end{aligned}
	$$
	则称 $f$ 为 $\mathbb K^n$ 上的 \emph{$m$ 重线性函数}。通俗地讲，多重线性函数的每一个参数都是线性的。
\end{definition}

例如，$\det(A)$ 是一个 $n$ 重线性函数。

\begin{definition}{对称的多重线性函数}
	设 $f$ 是一个多重线性函数，$a$ 是一个全排列，若 $f(\vec \alpha_1, \ldots, \vec \alpha_m) = f(\vec \alpha_{a_1}, \ldots, \vec \alpha_{a_m})$，则称 $f$ 是一个\emph{对称的多重线性函数}。
\end{definition}

\begin{definition}{反对称的多重线性函数}
	设 $f$ 是一个多重线性函数，$a$ 是一个全排列，若 $f(\vec \alpha_1, \ldots, \vec \alpha_m) = (-1)^{\tau(a)} f(\vec \alpha_{a_1}, \ldots, \vec \alpha_{a_m})$，其中 $\tau(a)$ 表示全排列 $a$ 的逆序数，则称 $f$ 是一个\emph{反对称的多重线性函数}。
\end{definition}

例如，$\det(A)$ 是一个反对称的多重线性函数。

\bigskip

当 $m = 2$ 时，考虑二重线性函数 $f \colon \mathbb K^n \times \mathbb K^n \to \mathbb K$，取 $\mathbb K^n$ 的一组基 $\{\vec e_i \colon i = 1, \cdots, n\}$，设 $f(\vec e_i, \vec e_j) = a_{ij} \in \mathbb K$，于是 $\forall \vec X, \vec Y \in \mathbb K^n$，我们可以计算出：
$$
\begin{aligned}
f(\vec X, \vec Y) &= f \biggl( \sum_{i = 1}^n x_i \vec e_i, \sum_{j = 1}^n y_j \vec e_j \biggr)
\\&=
\sum_{i = 1}^n \sum_{j = 1}^n x_i a_{ij} y_j
\end{aligned}
$$

注意到，上式可以表示为 $f(\vec X, \vec Y) = \vec X^T A \vec Y$。由此可见，$f$ 是对称的二重线性函数当且仅当 $A$ 是一个对称矩阵；$f$ 是一个反对称的二重线性函数当且仅当 $A$ 是一个反对称矩阵。

\bigskip

对于\textbf{对称的二重线性函数} $f(\vec X, \vec Y)$，我们来计算 $f(\vec X, \vec Y)$，可以考虑用以下方式：
$$
f(\vec X, \vec Y) = \dfrac{f(\vec X + \vec Y, \vec X + \vec Y) - f(\vec X, \vec X) - f(\vec Y, \vec Y)}{2}
$$

如果 $\vec X = \vec Y$，我们要研究的对象就是 $\vec X^T A \vec X$，只用研究 $\vec X$ 的 $n$ 个变量即可。而通过上式，我们知道了可以透过 $f(\vec X, \vec X)$ 来研究 $f(\vec X, \vec Y)$。下面我们就来研究 $f(\vec X, \vec X)$。

\begin{definition}{二次型}
	数域 $\mathbb K$ 上的一个 \emph{$n$ 元二次型}是系数在 $\mathbb K$ 中的 $n$ 个变量的二次\textbf{齐次}多项式，它的一般形式是：
	$$
	f(\vec X, \vec X) = \sum_{i = 1}^n \sum_{j = 1}^n a_{ij} x_i x_j = \sum_{i = 1}^n a_{ii} x_i^2 + 2 \sum_{i = 1}^n \sum_{j = i + 1}^n a_{ij} x_i x_j
	$$
\end{definition}

前面提到，二重线性函数可以表示为 $f(\vec X, \vec Y) = \vec X^T A \vec Y$，不难验证二次型与对称矩阵一一对应。

\begin{definition}{二次型的矩阵}
	称与二次型 $f$ 按以下关系一一对应的对称矩阵 $A = (a_{ij})$ 为\emph{二次型 $f$ 的矩阵}。
	$$
	f(\vec X, \vec X) = \sum_{i = 1}^n \sum_{j = 1}^n a_{ij} x_i x_j = \sum_{i = 1}^n a_{ii} x_i^2 + 2 \sum_{i = 1}^n \sum_{j = i + 1}^n a_{ij} x_i x_j
	$$
\end{definition}

\subsection{二次型标准形}

我们希望二次型能够形如 $a_{11} x_1^2 + a_{22} x_2^2 + \cdots + a_{nn} x_n^2$。如果一个二次型含有交叉项，我们能否通过一系列变换使得交叉项消失呢？最简单的思路就是配方。例如，给定三元二次型 $x_1^2 - 2x_1 x_2 + x_2 x_3 - x_3^2$，通过依次为 $x_1, x_2$ 配方，我们可以得到：
$$
\begin{aligned}&
	x_1^2 - 2x_1 x_2 + x_2 x_3 - x_3^2
	\\=~&
	(x_1 - x_2)^2 - x_2^2 + x_2x_3 - x_3^2
	\\=~&
	(x_1 - x_2)^2 - \biggl( x_2 - \dfrac{x_3}{2} \biggr)^2 - \dfrac{3}{4} x_3^2
\end{aligned}
$$

由于为 $x_2$ 配方后 $x_3$ 一定只剩下平方项，所以无需为 $x_3$ 配方。令：
$$
\begin{bmatrix} y_1 \\ y_2 \\ y_3 \end{bmatrix}
=
\begin{bmatrix}
	1 & -1 & 0
	\\
	0 & 1 & -\dfrac{1}{2}
	\\
	0 & 0 & 1
\end{bmatrix}
\begin{bmatrix} x_1 \\ x_2 \\ x_3 \end{bmatrix}
$$
则原二次型等于 $y_1^2 - y_2^2 - \dfrac{3}{4} y_3^2$。

受以上配方过程启发，我们给出以下定义。

\begin{definition}{非退化线性替换}
	令 $\vec Y = (y_1, \ldots, y_n)'$，设 $C$ 是数域 $\mathbb K$ 上的一个 $n$ 级\textbf{可逆}矩阵，则关系式 $\vec X = C \vec Y$ 称为变量 $x_1, \ldots, x_n$ 到变量 $y_1, \ldots, y_n$ 的一个\emph{非退化线性替换}。
\end{definition}

根据非退化线性替换的定义，我们要求矩阵 $C$ 是可逆矩阵，所以自然地可以得到一个等价关系。

\begin{definition}{二次型的等价}
	数域 $\mathbb K$ 上的两个 $n$ 元二次型 $\vec X^T A \vec X$ 与 $\vec Y^T B \vec Y$，如果存在一个非退化线性替换 $\vec X = C \vec Y$，把 $\vec X^T A \vec X$ 变成 $\vec Y^T B \vec Y$，那么称二次型 $\vec X^T A \vec X$ 与 $\vec Y^T B \vec Y$ \emph{等价}，记作 $\vec X^T A \vec X \cong \vec Y^T B \vec Y$。
\end{definition}

\begin{definition}{二次型标准形}
	如果 $\vec X^T A X$ 等价于一个只含平方项的二次型，那么这个只含平方项的二次型称为 $\vec X^T A \vec X$ 的一个\emph{标准形}。
\end{definition}

主观感受可知，通过配方，一定可以将任意二次型转换为只含平方项的二次型。我们不加证明地给出以下定理。

% TODO: 补充证明。

\begin{theorem}
	数域 $\mathbb K$ 上的任意二次型都可以通过非退化线性替换 $\vec X = P \vec Y$ 化为它的一个二次型标准形。
\end{theorem}

\subsection{实对称矩阵对应的二次型标准形：正交替换法}

注意到，实二次型对应的矩阵是实对称矩阵。实对称矩阵作为一类特殊的矩阵，其对应的二次型标准形还可以用以下方法求出。

\begin{theorem}
	实数域上的 $n$ 元二次型 $\vec X^T A \vec X$ 有一个标准形为 $\lambda_1 y_1^2 + \cdots + \lambda_n y_n^2$，其中 $\lambda_1, \ldots, \lambda_n$ 是 $A$ 的全部特征值。
\end{theorem}

\begin{proof}
	已知对于 $n$ 级实对称矩阵 $A$，存在一个 $n$ 级正交矩阵 $T$，使得 $T^{-1} AT = \operatorname{diag}\{\lambda_1, \ldots, \lambda_n\} = D$，其中 $\lambda_1, \ldots, \lambda_n$ 是 $A$ 的全部特征值。由于 $T^{-1} = T^T$，从而在变量的替换 $\vec X = T \vec Y$ 下，$\vec X^T A \vec X$ 化成二次型 $\lambda_1 y_1^2 + \cdots + \lambda_n y_n^2$。
\end{proof}

我们称以上这种特殊的替换为正交替换。

\begin{definition}{正交替换}
	如果 $T$ 是正交矩阵，那么变量的替换 $\vec X = T \vec Y$ 称为\emph{正交替换}。
\end{definition}

特别注意，正交替换法的前提是 $T^{-1} = T^T$。

\subsection{矩阵的合同}

二次型的变量替换可以表示为：
$$
\vec X^T A \vec X = (C \vec Y)^T A (C \vec Y) = \vec Y^T (C^T A C) \vec Y
$$

如果二次型的等价用其对应的矩阵表示，则上例中我们可以说 $A$ 与 $C^T A C$ 等价。事实上，矩阵的这种等价被称为合同。

\begin{definition}{合同}
	数域 $\mathbb K$ 上两个 $n$ 级矩阵 $A$ 与 $B$，如果存在 $\mathbb K$ 上一个 $n$ 级可逆矩阵 $C$，使得 $C^T AC = B$，那么称 $A$ 与 $B$ \emph{合同}，记作 $A \simeq B$。
\end{definition}

同理，由于要求矩阵 $C$ 可逆，所以合同也是一个等价关系，其相关概念定义如下。

\begin{definition}{合同类}
	在合同关系下，$A$ 的等价类称为 $A$ 的\emph{合同类}。
\end{definition}

\begin{definition}{合同标准形}
	如果对称矩阵 $A$ 合同于一个对角矩阵，那么这个对角矩阵称为 $A$ 的一个\emph{合同标准形}。
\end{definition}

注意合同标准形的定义中要求 $A$ 是对称矩阵。事实上，非对称矩阵不可能合同于一个对角矩阵，因为与对角矩阵合同的矩阵一定是对称矩阵。

由数域 $\mathbb K$ 上的任意二次型可以通过非退化线性替换 $\vec X = P \vec Y$ 化为它的一个二次型标准形，我们可以知道数域 $\mathbb K$ 上的任意对称矩阵都存在合同标准形，即数域 $\mathbb K$ 上任一对称矩阵都合同于一个对角矩阵。

\subsection{求合同标准形：初等变换法}

可以证明，数域 $\mathbb K$ 中的对称矩阵 $A$ 一定存在一个合同标准形。设 $P^T A P = D$，其中 $P$ 是可逆矩阵，$D$ 是对角矩阵。由于可逆矩阵可以表示成初等矩阵的乘积，故设：
$$
P = P_1 \cdots P_s
$$
其中 $P_1, \ldots, P_s$ 均为初等矩阵。于是：
$$
\begin{aligned}
	P^T A P &= (P_1 \cdots P_s)^T A (P_1 \cdots P_s)
	\\&=
	P_s^T \cdots P_1^T A P_1 \cdots P_s
\end{aligned}
$$

考察 $P_1^T A P_1$ 的意义。依次考虑三种初等矩阵：
\begin{enumerate}
	\item $P_1 = P(i, j)$，此时 $P_1^T = P(i, j)$，$P_1^T A P_1 = P(i, j) A P(i, j)$，意义为：交换 $A$ 的第 $i$ 列和第 $j$ 列，再交换 $A$ 的第 $i$ 行和第 $j$ 行。由矩阵乘法的结合律，也可以先交换行，再交换列。
	\item $P_1 = P(i(c))$，此时 $P_1^T = P(i(c))$，$P_1^T A P_1 = P(i(c)) A P(i(c))$，意义为：将 $A$ 的第 $i$ 列乘以 $c$，并将 $A$ 的第 $i$ 行乘以 $c$。同理，也可以先乘以行，再乘以列。
	\item $P_1 = P(j, i(k))$，此时 $P_1^T = P(i, j(k))$（注意 $P(j, i(k))$ 不是对称矩阵），$P_1^T A P_1 = P(i, j(k)) A P(j, i(k))$，意义为：将 $A$ 的第 $j$ 行乘以 $k$ 加到第 $i$ 行，并将 $A$ 的第 $j$ 列乘以 $k$ 加到第 $i$ 列。
\end{enumerate}

因为 $P_1^T A P_1$ 有以上意义，所以我们特将它称为成对初等行列变换。

\begin{definition}{成对初等行列变换}
	设 $P$ 是初等矩阵，称 $P^T A P$ 为对 $A$ 作\emph{成对初等行列变换}。
\end{definition}

\begin{theorem}
	设 $A, B$ 都是数域 $\mathbb K$ 上的 $n$ 级矩阵，则 $A$ 合同于 $B$，当且仅当 $A$ 经过一系列成对初等行列变换可以变成 $B$。并且对 $I$ 只作其中的初等列变换得到的可逆矩阵 $C$ 满足 $C^TAC = B$。
\end{theorem}

以上定理给出了求解矩阵的合同标准形的方法。具体使用方法见下例。
$$
A =
\begin{bmatrix}
	0 & 1 & 2
	\\
	1 & 0 & 0
	\\
	2 & 0 & 0
\end{bmatrix}
$$

\begin{solve}
	对 $A$ 进行一系列成对初等行列变换：
	$$
	\begin{gathered}
		\left[
		\begin{array}{c}
			\begin{matrix} 0 & 1 & 2 \\ 1 & 0 & 0 \\ 2 & 0 & 0 \end{matrix}
			\\\hline
			\begin{matrix} 1 & 0 & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1 \end{matrix}
		\end{array}
		\right]
		\to
		\left[
		\begin{array}{c}
			\begin{matrix} 1 & 1 & 2 \\ 1 & 0 & 0 \\ 2 & 0 & 0 \end{matrix}
			\\\hline
			\begin{matrix} 1 & 0 & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1 \end{matrix}
		\end{array}
		\right]
		\to
		\left[
		\begin{array}{c}
			\begin{matrix} 2 & 1 & 2 \\ 1 & 0 & 0 \\ 2 & 0 & 0 \end{matrix}
			\\\hline
			\begin{matrix} 1 & 0 & 0 \\ 1 & 1 & 0 \\ 0 & 0 & 1 \end{matrix}
		\end{array}
		\right]
		\to \cdots \to
		\left[
		\begin{array}{c}
			\begin{matrix} 2 & 0 & 0 \\ 0 & -\frac{1}{2} & 0 \\ 0 & 0 & 0 \end{matrix}
			\\\hline
			\begin{matrix} 1 & -\frac{1}{2} & 0 \\ 1 & -\frac{1}{2} & -2 \\ 0 & 0 & 1 \end{matrix}
		\end{array}
		\right]
	\end{gathered}
	$$

	令 $P = \begin{bmatrix} 1 & -\frac{1}{2} & 0 \\ 1 & \frac{1}{2} & -2 \\ 0 & 0 & 1 \end{bmatrix}$，则有：
	$$
	P^T A P =
	\begin{bmatrix}
		2 & 0 & 0
		\\
		0 & \frac{1}{2} & 0
		\\
		0 & 0 & 0
	\end{bmatrix}
	$$

	$P^T A P$ 即为 $A$ 的合同标准形，$P$ 是非退化线性替换。
\end{solve}

以上定理仅仅说明了求解对称矩阵合同标准形的方法，没有证明任何对称矩阵都可通过此方法求得合同标准形。但事实上，可以证明初等变换法对于对称矩阵总是有效的。

\begin{theorem}
	数域 $\mathbb K$ 上任一对称矩阵都合同于一个对角矩阵。特别地，总是可以使用初等变换法求出某个对称矩阵的合同标准形。
\end{theorem}

% TODO: 补充证明。

由于成对初等行列变换不改变矩阵的秩，所以我们可以定义二次型的秩，并得到以下定理。

\begin{definition}{二次型的秩}
	二次型 $\vec X^T A \vec X$ 的矩阵 $A$ 的秩称为\emph{二次型 $\vec X^T A \vec X$ 的秩}。
\end{definition}

\begin{theorem}
	数域 $\mathbb K$ 上的 $n$ 元二次型 $\vec X^T A \vec X$ 的任一标准形中，系数不为 $0$ 的平方项个数等于它的秩。
\end{theorem}