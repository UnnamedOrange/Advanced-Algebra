% Licensed under the Creative Commons Attribution Share Alike 4.0 International.
% See the LICENSE file in the repository root for full license text.

\chapter{矩阵的运算}

\section{矩阵的加法和数量乘法}

将矩阵看作一个集合中的元素，自然想到可以为矩阵定义运算。为了书写关于矩阵的等式，我们首先定义矩阵的相等。

\begin{definition}{相等}
	设数域 $\mathbb K$ 上的两个矩阵分别为 $A$ 和 $B$。如果它们的行数相等，列数也相等，并且它们的所有元素对应相等（即第一个矩阵的 $(i, j)$ 元等于第二个矩阵的 $(i, j)$ 元），那么称 $A$ 与 $B$ \emph{相等}，记作 $A = B$。
\end{definition}

类似于向量，我们可以很自然地想到定义矩阵的加法和数量乘法。

\begin{definition}{和}
	设 $A = (a_{ij})$ 和 $B = (b_{ij})$ 都是数域 $\mathbb K$ 上的 $s \times n$ 矩阵。令 $C = (a_{ij} + b_{ij})_{s \times n}$，则称 $C$ 是矩阵 $A$ 与 $B$ 的\emph{和}，记作 $C = A + B$。
\end{definition}

\begin{definition}{数量乘积}
	设 $A = (a_{ij})$ 是数域 $\mathbb K$ 上的 $s \times n$ 矩阵，$k \in \mathbb K$。令 $M = (k a_{ij})_{s \times n}$，则称 $M$ 是 $k$ 与矩阵 $A$ 的\emph{数量乘积}，记作 $M = k A$。
\end{definition}

类似于向量空间中加法的负元，我们为矩阵定义其负矩阵。

\begin{definition}{负矩阵}
	设 $A = (a_{ij})_{s \times n}$，则矩阵 $(-a_{ij})_{s \times n}$ 称为 $A$ 的\emph{负矩阵}，记作 $-A$。
\end{definition}

容易验证，矩阵的加法与数量乘法满足类似于 $n$ 维向量的加法与数量乘法所满足的 $8$ 条运算法则。对于 $\mathbb K$ 上的 $s \times n$ 矩阵的运算，满足：
\begin{enumerate}
	\item 加法交换律。
	\item 加法结合律。
	\item 存在唯一零元（加法的单位元），称为零矩阵，记为 $\mathbf 0$。
	\item 任一矩阵存在负元（加法的逆元），即负矩阵。
	\item 数乘的单位元。
	\item 数乘的乘法结合律。
	\item 数的乘法分配律。
	\item 矩阵的乘法分配律。
\end{enumerate}

最后，利用负矩阵的概念，我们可以定义矩阵的减法。

\begin{definition}{差}
	设 $A, B$ 都是 $s \times n$ 矩阵，则矩阵减法 $A - B$ 定义为 $A + (-B)$，称为 $A$ 与 $B$ 的\emph{差}。
\end{definition}

\section{$\mathbb K^n$ 到 $\mathbb K^s$ 的线性映射——矩阵乘法}

矩阵还可以做什么运算？为了回答这一问题，需要研究 $\mathbb K^n$ 到 $\mathbb K^s$ 的线性映射。首先，我们在此明确提出映射及其相关概念。

\subsection{映射}

\begin{definition}{映射,象,原象}
	设 $S$ 和 $S'$ 是两个集合，如果存在一个对应法则 $f$，使得集合 $S$ 中的每一个元素 $a$，都有集合 $S'$ 中唯一确定的元素 $b$ 与它对应，那么称 $f$ 是集合 $S$ 到 $S'$ 的一个\emph{映射}，记作：
	$$
	\begin{aligned}
		f \colon & S \to S'
		\\&
		a \mapsto b
	\end{aligned}
	$$

	其中 $b$ 称为 $a$ 在 $f$ 下的\emph{象}，$a$ 称为 $b$ 在 $f$ 下的一个\emph{原象}。$a$ 在 $f$ 下的象用符号 $f(a)$ 表示，于是映射 $f$ 也可以记成 $f(a) = b \pod{a \in S}$。
\end{definition}

\begin{definition}{定义域,陪域,值域,映射的象}
	设 $f$ 是集合 $S$ 到集合 $S'$ 的一个映射，则把 $S$ 叫做映射 $f$ 的\emph{定义域}，把 $S'$ 叫做 $f$ 的\emph{陪域}。$S$ 的所有元素在 $f$ 下的象组成的集合叫做 $f$ 的\emph{值域}或 $f$ 的\emph{象}，记作 $f(S)$ 或 $\operatorname{Im} f$。容易看出，$f$ 的值域是 $f$ 的陪域的子集。
\end{definition}

\begin{definition}{满射}
	设 $f$ 是集合 $S$ 到集合 $S'$ 的一个映射，如果 $f(S) = S'$，那么称 $f$ 是\emph{满射}（或 $f$ 是 $S$ 到 $S'$ 上的映射）。可知，$f$ 是满射当且仅当 $f$ 的陪域中每一个元素都有至少一个原象。
\end{definition}

\begin{definition}{单射}
	如果映射 $f$ 的定义域 $S$ 中不同的元素的象也不同，那么称 $f$ 是\emph{单射}。可知，$f$ 是单射当且仅当从 $a_1, a_2 \in S$ 且 $f(a_1) = f(a_2)$ 可以推出 $a_1 = a_2$。
\end{definition}

\begin{definition}{双射,一一对应}
	如果映射 $f$ 既是单射，又是满射，那么称 $f$ 是\emph{双射}（或 $f$ 是 $S$ 到 $S'$ 的一个\emph{一一对应}）。显然，$f$ 是双射当且仅当陪域中每一个元素都有唯一的一个原象。
\end{definition}

\begin{definition}{相等}
	 如果映射 $f$ 与映射 $g$ 的定义域相等，陪域相等，并且对应法则相同（即 $\forall x \in S$，有 $f(x) = g(x)$），则称映射 $f$ 与映射 $g$ \emph{相等}。
\end{definition}

下面提出一些常用的名词或概念。

\begin{definition}{变换}
	集合 $S$ 到自身的一个映射，通常称为 $S$ 上的一个\emph{变换}。
\end{definition}

\begin{definition}{函数}
	集合 $S$ 到数集（数域 $\mathbb K$ 的任一非空子集）的一个映射，通常称为 $S$ 上的一个\emph{函数}。
\end{definition}

\begin{definition}{原象集}
	陪域 $S'$ 中的元素 $b$ 在映射 $f$ 下的所有原象组成的集合称为 $b$ 在 $f$ 下的\emph{原象集}，记作 $f^{-1}(b)$。
\end{definition}

\begin{definition}{恒等映射,恒等变换}
	如果映射 $f \colon S \to S$ 把 $S$ 中每一个元素对应到它自身，即 $\forall x \in S$，有 $f(x) = x$，那么称 $f$ 是\emph{恒等映射}（或 $S$ 上的\emph{恒等变换}），记作 $1_S$。
\end{definition}

\begin{definition}{乘积,合成,复合}
	相继施行映射 $g: S \to S'$ 和 $f \colon S' \to S''$，得到 $S$ 到 $S''$ 的一个映射，称为 $f$ 与 $g$ 的\emph{乘积}（或\emph{合成}，或\emph{复合}），记作 $fg$（或 $f \circ g$）。即有 $(fg)(a) = f(g(a)) \pod{\forall a \in S}$。
\end{definition}

我们发现，在一个由映射组成的集合中，两映射之间可以进行比较和运算，还存在恒等映射的概念。所以我们接下来进一步研究这些概念与性质，并相应地提出逆映射等概念。

\begin{theorem}
	设 $h \colon S \to S$，$g \colon S' \to S''$，$f \colon S'' \to S'''$，则有 $f(gh) = (fg)h$，即映射的合成满足结合律。
\end{theorem}

需要注意，映射的合成不满足交换律。

\begin{theorem}
	对于任意一个映射 $f \colon S \to S'$，都有 $f 1_S = f = 1_{S'} f$。
\end{theorem}

\begin{definition}{可逆,逆映射}
	设 $f \colon S \to S'$，如果存在一个映射 $g \colon S' \to S$，使得 $fg = 1_{S'}$ 且 $gf = 1_S$，那么称映射 $f$ 是\emph{可逆}的，$g$ 是 $f$ 的一个\emph{逆映射}。
\end{definition}

\begin{theorem}
	如果映射 $f$ 是可逆的，那么它的逆映射是唯一的。
\end{theorem}

\begin{proof}
	设 $g$ 和 $h$ 都是 $f$ 的一个逆映射，则：
	$$
	h(fg) = h 1_{S'} = h
	$$

	由结合律又知：
	$$
	h(fg) = (hf)g = 1_S g = g
	$$

	所以 $h = g$。
\end{proof}

所以我们可以记 $f$ 的逆映射为 $f^{-1}$。

\begin{theorem}
	映射 $f \colon S \to S'$ 可逆的充分必要条件为 $f$ 是双射。
\end{theorem}

% TODO: 补充证明。

证明略。

\subsection{线性映射与矩阵乘法的定义}

\begin{definition}{线性映射}
	如果 $\mathbb K^n$ 到 $\mathbb K^s$ 的一个映射 $\sigma$ 保持加法和数量乘法，那么称 $\sigma$ 是 $\mathbb K^n$ 到 $\mathbb K^s$ 的一个\emph{线性映射}。所谓保持加法和数量乘法，是指：
	$$
	\forall \vec \alpha, \vec \beta \in \mathbb K^n, k \in \mathbb K
	$$
	都有：
	$$
	\sigma(\vec \alpha + \vec \beta) = \sigma(\vec \alpha) + \sigma(\vec \beta), \sigma(k \vec \alpha) = k \sigma (\vec \alpha)
	$$
\end{definition}

下面尝试从线性映射的概念出发定义矩阵乘法。设某一 $\mathbb K^n$ 到 $\mathbb K^s$ 的线性映射为 $\phi$。考察 $\mathbb K^n$ 的标准基 $\vec e_1, \ldots, \vec e_n$，如果我们已知：
$$
\phi(\vec e_1) = \vec \alpha_1, \ldots, \phi(\vec e_n) = \vec \alpha_n
$$
那么事实上我们可以求出 $\mathbb K^n$ 中的任一向量 $\vec x$ 在 $\phi$ 下的象。设 $\vec x = (x_1, \ldots, x_n)'$，则有：
$$
\begin{aligned}
	\phi(\vec x) &= \phi(x_1 \vec e_1 + \cdots + x_n \vec e_n)
	\\&=
	\phi(x_1 \vec e_1) + \phi(x_2 \vec e_2 + \cdots + x_n \vec e_n)
	\\&=
	x_1 \phi(\vec e_1) + \phi(x_2 \vec e_2 + \cdots + x_n \vec e_n)
	\\&=
	x_1 \vec \alpha_1 + \cdots + x_n \vec \alpha_n
\end{aligned}
$$

受 $\phi(x) = x_1 \vec \alpha_1 + \cdots + x_n \vec \alpha_n$ 的启发，我们定义矩阵的乘积如下。

\begin{definition}{矩阵的乘积}
	设 $A = (a_{ij})_{s \times n}, B = (b_{ij})_{n \times m}$，令 $C = (c_{ij})_{s \times m}$，其中：
	$$
	c_{ij} = \sum\limits_{k = 1}^n a_{ik} b_{kj} \pod{i = 1, \ldots, s; j = 1, \ldots, m}
	$$
	则矩阵 $C$ 称为\emph{矩阵 $A$ 与 $B$ 的乘积}，记作 $C = AB$。
\end{definition}

如此定义后，记矩阵 $A = \begin{bmatrix} \vec \alpha_1 & \cdots & \vec \alpha_n \end{bmatrix}$（$\vec \alpha_i \pod{i = 1, \ldots, n}$ 都是列向量），并把 $\vec x$ 和 $\phi(\vec x)$ 都看作 $n \times 1$ 的矩阵，则 $\phi(\vec x) = x_1 \vec \alpha_1 + \cdots + x_n \vec \alpha_n$ 便可用矩阵乘法记为 $\phi(\vec x) = A \vec x$。

\subsection{矩阵与线性映射的一一对应关系}

以上对矩阵乘法的定义只是一个受启发后的产物。矩阵乘法与有限维向量空间的线性映射还有什么更深刻的关系？首先需要知道矩阵与线性映射的一一对应关系。

\begin{theorem}
	设 $A, B$ 为两个任意的 $n$ 列的矩阵。若对于 $\mathbb K^n$ 中的任一列向量 $\vec x$，都有 $A \vec x = B \vec x$，则 $A = B$。
\end{theorem}

\begin{proof}
	取 $\vec x = \vec e_i \pod{i = 1, \ldots, n}$，则可知 $A \vec e_i = B \vec e_i$。这意味着 $A$ 的第 $i$ 列与 $B$ 的第 $i$ 列相等。考虑 $i = 1, \ldots, n$，可知 $A$ 与 $B$ 的每一列都相等，即 $A = B$。
\end{proof}

\begin{theorem}
	若 $\phi \colon \mathbb K^n \to \mathbb K^m$ 是一个线性映射，则存在唯一的 $m \times n$ 矩阵 $A$，使得 $\phi(\vec x) = A \vec x$。
\end{theorem}

\begin{proof}[反证法]
	由前文中的 $\phi(x) = x_1 \vec \alpha_1 + \cdots + x_n \vec \alpha_n$ 即可证得存在性，下面证唯一性。假设存在矩阵 $B \ne A$ 使得 $\varphi(\vec x) = B \vec x$，则有 $A \vec x = B \vec x$，但这又意味着 $A = B$，所以满足 $\phi(\vec x) = A \vec x$ 的矩阵 $A$ 是唯一的。
\end{proof}

\begin{theorem}
	设矩阵 $A$ 是任意一个 $m \times n$ 矩阵。若映射 $\phi$ 满足：
	$$
	\begin{aligned}
		\phi \colon & \mathbb K^n \to \mathbb K^m
		\\&
		\vec x \mapsto A \vec x
	\end{aligned}
	$$

	则 $\phi$ 是一个线性映射。
\end{theorem}

\begin{proof}
	只需证明 $A (k \vec x) = kA \vec x$ 且 $A (\vec x + \vec y) = A \vec x + A \vec y$。将在之后的内容中进行证明。
\end{proof}

\subsection{矩阵乘法的更多理解方式}

设矩阵 $A = (a_{ij})_{s \times n}, B = (b_{ij})_{n \times m}$。矩阵乘法 $C = AB = (c_{ij})_{s \times m}$ 的定义式为：
$$
c_{ij} = \sum\limits_{k = 1}^n a_{ik} b_{kj} \pod{i = 1, \ldots, s; j = 1, \ldots, m}
$$

只看定义式是比较抽象的，下面我们介绍两种对偶的更易理解的表述方式。

\begin{enumerate}
	\item 设：
	$$
	B = \begin{bmatrix} \vec \beta_1 & \vec \beta_2 & \cdots & \vec \beta_n \end{bmatrix}
	$$

	则：
	$$
	C = \begin{bmatrix} A \vec \beta_1 & A \vec \beta_2 & \cdots & A \vec \beta_n \end{bmatrix}
	$$

	又即，$C$ 的每一列是 $A$ 的各列向量以 $B$ 的对应列为权的加权和。


	\item 设：
	$$
	A = \begin{bmatrix} \vec \alpha_1 \\ \vec \alpha_2 \\ \vdots \\ \vec \alpha_n \end{bmatrix}
	$$

	则：
	$$
	C = \begin{bmatrix} \vec \alpha_1 B \\ \vec \alpha_2 B \\ \vdots \\ \vec \alpha_n B \end{bmatrix}
	$$

	又即，$C$ 的每一行是 $B$ 的各行向量以 $A$ 的对应行为权的加权和。
\end{enumerate}

\begin{proof}
	只证 “$C$ 的每一行是 $B$ 的各行向量以 $A$ 的对应行为权的加权和”。根据矩阵乘法的定义，$C$ 的第 $i$ 行为：
	$$
	\begin{pmatrix}
		a_{i1} b_{11} + a_{i2} b_{21} + \cdots + a_{in} b_{n1}
		\\
		a_{i1} b_{12} + a_{i2} b_{22} + \cdots + a_{in} b_{n2}
		\\
		\vdots
		\\
		a_{i1} b_{1m} + a_{i2} b_{2m} + \cdots + a_{in} b_{nm}
	\end{pmatrix}'
	$$
	注意上式是一个行向量，只是记为了列向量的转置。

	注意到上式中 $b_{jk}$ 的系数都是 $a_{ij}$（即该系数与 $k$ 无关），因此上式可以拆为：
	$$
	a_{i1}
	\begin{pmatrix}
		b_{11} \\ b_{12} \\ \vdots \\ b_{1m}
	\end{pmatrix}'
	+
	a_{i2}
	\begin{pmatrix}
		b_{21} \\ b_{22} \\ \vdots \\ b_{2m}
	\end{pmatrix}'
	+
	\cdots
	+
	a_{in}
	\begin{pmatrix}
		b_{n1} \\ b_{n2} \\ \vdots \\ b_{nm}
	\end{pmatrix}'
	$$

	这即说明 $C$ 的第 $i$ 行是 $B$ 的各行向量以 $A$ 的第 $i$ 行为权的加权和。
\end{proof}

在后面我们可以看到，这种将矩阵拆分为若干向量，乃至若干“块”的思路有着重要应用。

\subsection{线性映射的复合}

我们继续研究线性映射。线性映射的复合满足什么性质？直觉告诉我们，线性映射的复合仍然是线性映射。

\begin{theorem}
	若 $\phi_1 \colon \mathbb K^n \to \mathbb K^m$ 和 $\phi_2 \colon \mathbb K^m \to \mathbb K_s$ 均为线性映射，则它们的复合 $(\phi_2 \circ \phi_1)$ 仍然是线性映射。
\end{theorem}

\begin{proof}
	按定义证明。设 $\vec \alpha, \vec \beta$ 是 $\mathbb K^n$ 中的任意两个向量，考察：
	$$
	\begin{aligned}
		(\phi_2 \circ \phi_1) (\vec \alpha + \vec \beta) &= \phi_2(\phi_1(\vec \alpha + \vec \beta))
		\\&=
		\phi_2(\phi_1(\vec \alpha) + \phi_1(\vec \beta))
		\\&=
		\phi_2(\phi_1(\vec \alpha)) + \phi_2(\phi_1(\vec \beta))
		\\&=
		(\phi_2 \circ \phi_1)(\vec \alpha) + (\phi_2 \circ \phi_1)(\vec \beta)
	\end{aligned}
	$$$$
	\begin{aligned}
		(\phi_2 \circ \phi_1)(\lambda \vec \alpha) &= \phi_2(\phi_1(\lambda \vec \alpha))
		\\&=
		\phi_2(\lambda \phi_1(\vec \alpha))
		\\&=
		\lambda \phi_2(\phi_1(\vec \alpha))
		\\&=
		\lambda (\phi_2 \circ \phi_1)(\vec \alpha)
	\end{aligned}
	$$
\end{proof}

线性映射的复合对应的矩阵是什么？我们给出如下定理。

\begin{theorem}
	设任意两个线性映射分别为 $\phi_1 \colon \mathbb K^n \to \mathbb K^m$ 和 $\phi_2 \colon \mathbb K^m \to \mathbb K_s$，它们对应的左乘矩阵分别为 $A_{m \times n}, B_{s \times m}$。若 $(\phi_2 \circ \phi_1)(\vec x) = M \vec x$，则 $M = BA$。
\end{theorem}

% TODO: 按照原有的笔记进行证明。

\begin{proof}
	$$
	\begin{aligned}
		(\phi_2 \circ \phi_1)(\vec x) &= \phi_2(\phi_1(\vec x))
		\\&=
		\phi_2(A \vec x)
		\\&=
		B(A \vec x)
	\end{aligned}
	$$

	若矩阵乘法满足结合律，则上式成立。矩阵乘法的结合律将在后文进行证明。
\end{proof}

\subsection{线性映射的单射性与满射性}

在这初探线性映射与矩阵乘法的小节，我们用线性映射的单射性和满射性结尾，旨在为后面的内容做一个引子。

对于线性映射 $\phi \colon \mathbb K^n \to \mathbb K^m$，可以稍微具体地描述其单射性和满射性：
\begin{itemize}
	\item 若 $\phi$ 是单射，则从 $\phi(\vec x) = \phi(\vec y)$ 可以推出 $\vec x = \vec y$。
	\item 若 $\phi$ 是满射，则 $\forall \vec z \in \mathbb K^m, \exists \vec x \in \mathbb K^n$，使得 $\phi(\vec x) = \vec z$。
\end{itemize}

清楚以上两点后，可以更好地理解线性映射的单射性和满射性。

\bigskip

线性映射什么时候是单射，什么时候是满射？我们给出以下三个重要的定理。

\begin{theorem}
	设线性映射 $\phi \colon \mathbb K^n \to \mathbb K^m$ 对应的左乘矩阵为 $A_{m \times n}$。$\phi$ 是单射的充分必要条件是 $\operatorname{rank}(A) = n$，即 $A$ 列满秩。
\end{theorem}

\begin{proof}
	$$
	\begin{aligned}&
		\text{$\phi$ 是单射。}
		\\\Longleftrightarrow~&
		\text{$\phi(\vec 0) = \vec 0$ 且 $\Bigl( \phi(\vec x) = \phi(\vec y) \Longleftrightarrow \vec x = \vec y \Bigr)$}
		\\\Longleftrightarrow~&
		\text{$\Bigl( \phi(\vec x) = \vec 0 \Longleftrightarrow \vec x = \vec 0 \Bigr)$}
		\\\Longleftrightarrow~&
		\text{$\Bigl(A \vec x = \vec 0 \Longleftrightarrow \vec x = \vec 0 \Bigr)$}
		\\\Longleftrightarrow~&
		\text{齐次线性方程组 $A \vec x = \vec 0$ 只有零解。}
		\\\Longleftrightarrow~&
		\text{$\dim \{ \vec x \colon A \vec x = \vec 0 \} = 0$}
		\\\Longleftrightarrow~&
		\text{$\operatorname{rank}(A) = n$}
	\end{aligned}
	$$
\end{proof}

\begin{theorem}
	设线性映射 $\phi \colon \mathbb K^n \to \mathbb K^m$ 对应的左乘矩阵为 $A_{m \times n}$。$\phi$ 是满射的充分必要条件是 $\operatorname{rank}(A) = m$，即 $A$ 行满秩。
\end{theorem}

\begin{proof}
	设：
	$$
	A = \begin{bmatrix} \vec \alpha_1 & \vec \alpha_2 & \cdots & \vec \alpha_n \end{bmatrix}
	$$

	$$
	\begin{aligned}&
		\text{$\phi$ 是满射。}
		\\\Longleftrightarrow~&
		\text{$\phi(\mathbb K^n) = \langle \vec \alpha_1, \ldots, \vec \alpha_n \rangle$}
		\\\Longleftrightarrow~&
		\text{$\mathbb K^m = \langle \vec \alpha_1, \ldots, \vec \alpha_n \rangle$}
		\\\footnote{设 $U$ 和 $W$ 是 $\mathbb K^n$ 的两个非零子空间，且 $U \subseteq W$。如果 $\dim U = \dim W$，那么 $U = W$。}\Longleftrightarrow~&
		\text{$\dim \langle \vec \alpha_1, \ldots, \vec \alpha_n \rangle = m$}
		\\\Longleftrightarrow~&
		\text{$\operatorname{rank}(A) = m$}
	\end{aligned}
	$$
\end{proof}

\begin{theorem}
	设线性映射 $\phi \colon \mathbb K^n \to \mathbb K^m$ 对应的左乘矩阵为 $A_{m \times n}$。$\phi$ 是一一对应的充分必要条件是 $\operatorname{rank}(A) = m = n$，即 $A$ 是一个满秩的方阵。
\end{theorem}

显然成立。